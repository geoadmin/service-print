import ConfigParser
import sys
import os

parent_dir = os.path.abspath(__file__ + "/../../")
activate_this = os.path.join(parent_dir, ".venv/bin/activate_this.py")

execfile(activate_this, dict(__file__=activate_this))

from paste.deploy import loadapp
from standalone import StandaloneApplication, number_of_workers

if sys.version_info >= (2, 6):
    from logging.config import fileConfig
else:
    from paste.script.util.logging_config import fileConfig

configfile = os.path.join(parent_dir, "${MODWSGI_CONFIG}")
try:
    fileConfig(configfile)
except:
    pass

application = loadapp("config:" + configfile, name=None)


if __name__ == '__main__':
     PROXYWMS_PORT = str(os.environ.get('PROXYWMS_PORT', 9001))
     options = {
         'bind': '%s:%s' % ('0.0.0.0', PROXYWMS_PORT),
         'worker_class': 'gevent',
         'workers': number_of_workers(),
     
     }
     StandaloneApplication(application, options).run()

