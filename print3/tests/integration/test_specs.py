# -*- coding: utf-8 -*-

from print3.tests.integration import TestsBase


VALID_SPEC = '''{"layout":"1 A4 landscape","srs":"EPSG:21781","units":"m","rotation":0,"app":"config","lang":"fr","dpi":"150","layers":[{"layer":"ch.swisstopo.pixelkarte-farbe","opacity":1,"type":"WMTS","baseURL":"https://wmts.geo.admin.ch","maxExtent":[420000,30000,900000,350000],"tileOrigin":[420000,350000],"tileSize":[256,256],"resolutions":[4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5],"zoomOffset":0,"version":"1.0.0","requestEncoding":"REST","formatSuffix":"jpeg","style":"default","dimensions":["TIME"],"params":{"TIME":"current"},"matrixSet":"21781"}],"qrcodeurl":"https://api3.geo.admin.ch/qrcodegenerator?url=https%3A%2F%2Fmap.geo.admin.ch%2F%3Ftopic%3Dech%26lang%3Dfr%26bgLayer%3Dch.swisstopo.pixelkarte-farbe%26layers%3Dch.swisstopo.zeitreihen%2Cch.bfs.gebaeude_wohnungs_register%2Cch.bav.haltestellen-oev%2Cch.swisstopo.swisstlm3d-wanderwege%26layers_visibility%3Dfalse%2Cfalse%2Cfalse%2Cfalse%26layers_timestamp%3D18641231%2C%2C%2C%26X%3D157600.00%26Y%3D623600.00%26zoom%3D3","movie":false,"pages":[{"center":[623600,157599.99999999997],"bbox":[595307.2222222222,138902.77777777775,651892.7777777778,176297.2222222222],"display":[802,530],"scale":"200000.0","dataOwner":"© swisstopo","thirdPartyDataOwner":false,"shortLink":"https://s.geo.admin.ch/71bfe060d4","rotation":0,"langfr":true,"timestamp":""}]}'''

BOGUS_SPEC = '''{"layout":"1 A4 landscape","srs":"EPSG:21781","units":"m","rotation":0,"app":"config","lang":"fr","dpi":"150","layers":[{"layer":"ch.swisstopo.swissimage","opacity":1,"type":"WMTS","baseURL":"https://wmts.geo.admin.ch","maxExtent":[420000,30000,900000,350000],"tileOrigin":[420000,350000],"tileSize":[256,256],"resolutions":[4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,0.5,0.25],"zoomOffset":0,"version":"1.0.0","requestEncoding":"REST","formatSuffix":"jpeg","style":"default","dimensions":["TIME"],"params":{"TIME":"current"},"matrixSet":"21781"},{"opacity":1,"type":"Vector","styles":{"0":{"id":0,"fillColor":"#ffff00","fillOpacity":0.4,"strokeWidth":1.8,"strokeColor":"#ffff00","strokeOpacity":1,"strokeLinecap":"round","strokeLinejoin":"round"},"1":{"id":1,"fillColor":"#ffff00","fillOpacity":0.4,"strokeWidth":1.8,"strokeColor":"#ffff00","strokeOpacity":1,"strokeLinecap":"round","strokeLinejoin":"round"},"2":{"id":2,"fillColor":"#aaff00","fillOpacity":0.4,"strokeWidth":1.8,"strokeColor":"#ffff00","strokeOpacity":1,"strokeLinecap":"round","strokeLinejoin":"round"},"3":{"id":3,"fillColor":"#ffff00","fillOpacity":0.4,"strokeWidth":1.8,"strokeColor":"#ffff00","strokeOpacity":1,"strokeLinecap":"round","strokeLinejoin":"round"},"4":{"id":4,"fillColor":"#ffff00","fillOpacity":0.4,"strokeWidth":1.8,"strokeColor":"#ffff00","strokeOpacity":1,"strokeLinecap":"round","strokeLinejoin":"round"}},"styleProperty":"_gx_style","geoJson":{"type":"FeatureCollection","features":[{"type":"Feature","id":"linepolygon_1487775469410","geometry":{"type":"MultiPolygon","coordinates":[[[[616140.5276172252,264330.2366253879,0],[617892.5853335105,263584.77145871567,0],[616140.5276172252,264330.2366253879,0]]],[[[616140.5276172252,264330.2366253879,0],[617892.5853335105,263584.77145871567,0],[616140.5276172252,264330.2366253879,0],[616140.5276172252,264330.2366253879,0]]]]},"properties":{"value":"linepolygon","type":"linepolygon","description":"","_gx_style":0}},{"type":"Feature","id":"linepolygon_1487775566647","geometry":{"type":"Polygon","coordinates":[[[618210.7428178838,263659.12170777057,0],[618211.7898149539,263662.9307074047,0],[618210.7428178838,263659.12170777057,0]]]},"properties":{"value":"linepolygon","type":"linepolygon","description":"","_gx_style":1}},{"type":"Feature","id":"linepolygon_1487775549368","geometry":{"type":"LineString","coordinates":[[616140.5276172252,264330.2366253879,0],[616461.610295283,264932.3964673126,0],[618178.2854068455,264120.49655651615,0],[617892.5853335105,263584.77145871567,0],[616140.5276172252,264330.2366253879,0]]},"properties":{"value":"linepolygon","type":"linepolygon","description":"","_gx_style":2}},{"type":"Feature","id":"linepolygon_1487775632091","geometry":{"type":"LineString","coordinates":[[616226.0253873394,264563.219734223,0],[615933.6403772823,264708.4547273478,0]]},"properties":{"value":"linepolygon","type":"linepolygon","description":"","_gx_style":3}},{"type":"Feature","id":"linepolygon_1487775644994","geometry":{"type":"LineString","coordinates":[[615931.9754297719,264704.88722246385,0],[615933.5076757856,264708.38967496157,0],[615935.5454218385,264711.789726434,0]]},"properties":{"value":"linepolygon","type":"linepolygon","description":"","_gx_style":4}}]}}],"qrcodeurl":"https://api3.geo.admin.ch/qrcodegenerator?url=https%3A%2F%2Fmap.geo.admin.ch%2F%3Flang%3Dfr%26topic%3Dech%26bgLayer%3Dch.swisstopo.swissimage%26layers%3Dch.swisstopo.zeitreihen%2Cch.bfs.gebaeude_wohnungs_register%2Cch.bav.haltestellen-oev%2Cch.swisstopo.swisstlm3d-wanderwege%2CKML%257C%257Chttps%3A%252F%252Fwww.procrastinatio.org%252Fkml%252F2points-multipolygons.kml%26layers_visibility%3Dfalse%2Cfalse%2Cfalse%2Cfalse%2Ctrue%26layers_timestamp%3D18641231%2C%2C%2C%2C%26X%3D263903.70%26Y%3D618494.07%26zoom%3D6","movie":false,"pages":[{"center":[618494.07,263903.69999999995],"bbox":[614957.4727777777,261566.54722222217,622030.6672222222,266240.8527777777],"display":[802,530],"scale":"25000.0","dataOwner":"© CNES, Spot Image, swisstopo, NPOC,","thirdPartyDataOwner":"www.procrastinatio.org","shortLink":"https://s.geo.admin.ch/71bfa62ee8","rotation":0,"langfr":true,"timestamp":""}]}'''


class TestPrintMultiView(TestsBase):

    def test_valid_spec(self):
        self.testapp.post('/printmulti/create.json', VALID_SPEC, headers={'Referer': 'http://map.ci.geo.admin.ch',
                                                                       'Content-Type': 'application/json;charset=utf-8'}, status=200)

    def test_invalid_spec(self):
        self.testapp.post('/printmulti/create.json', BOGUS_SPEC, headers={'Referer': 'http://map.ci.geo.admin.ch',
                                                                       'Content-Type': 'application/json;charset=utf-8'}, status=400)
